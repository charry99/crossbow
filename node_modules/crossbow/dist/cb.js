#!/usr/bin/env node
"use strict";
var config_1 = require("./config");
var task_runner_1 = require("./task.runner");
var cli_1 = require("./cli");
var fs_1 = require("fs");
var index_1 = require("./index");
var logger_1 = require("./logger");
var reports = require("./reporter.resolve");
var file = require("./file.utils");
var seq = require("./task.sequence");
var Rx = require("rx");
var file_utils_1 = require("./file.utils");
var debug = require("debug")("cb:cli");
var _ = require('../lodash.custom');
var parsed = cli_1.default(process.argv.slice(2));
var defaultReporter = reports.getDefaultReporter();
var defaultReporterFn = function (input) {
    var output = defaultReporter(input);
    if (output.data.length) {
        output.data.forEach(function (line) { return logger_1.default.info(line); });
    }
};
if (parsed.execute) {
    runFromCli(parsed, defaultReporterFn);
}
else {
    if (parsed.cli.flags.version) {
        console.log(parsed.output[0]);
    }
    else {
        if (parsed.output.length) {
            parsed.output.forEach(function (line) {
                logger_1.default.info(line);
            });
        }
    }
}
function runFromCli(parsed, cliDefaultReporter) {
    var addReporterIfMissing = function (setup, fn) {
        return setup.reporters.length > 0
            ? setup
            : _.assign({}, setup, { reportFn: fn });
    };
    var addSignalFnIfMissing = function (setup, obs) {
        return setup.config.signalObserver
            ? setup
            : _.set(setup, 'config.signalObserver', obs);
    };
    var addLoadDefaultsIfUndefined = function (cli) {
        return typeof cli.flags.loadDefaultInputs === "undefined"
            ? _.set(cli, 'flags.loadDefaultInputs', true)
            : cli;
    };
    var cliSignalObserver = new Rx.Subject();
    var killSwitches$ = new Rx.Subject();
    killSwitches$.subscribe(function () {
        process.exit(1);
    });
    file_utils_1.Right(parsed.cli)
        .map(function (cli) { return addLoadDefaultsIfUndefined(cli); })
        .chain(function (cli) { return index_1.getSetup(cli); })
        .map(function (x) { return addReporterIfMissing(x, cliDefaultReporter); })
        .map(function (x) { return addSignalFnIfMissing(x, cliSignalObserver); })
        .fold(function (err) {
        // todo log input errors
        cliDefaultReporter(err);
        killSwitches$.onNext(true);
        return err;
    }, function (setup) {
        setup.reportFn({
            type: reports.ReportTypes.UsingInputFile, data: { sources: setup.userInput.sources }
        });
        if (parsed.cli.command === 'run') {
            runWithSetup(setup, killSwitches$);
        }
        if (parsed.cli.command === 'docs') {
            docsWithSetup(setup, killSwitches$);
        }
        if (parsed.cli.command === 'init') {
            initWithSetup(setup, killSwitches$);
        }
        if (parsed.cli.command === 'tasks' || parsed.cli.command === 'ls') {
            tasksWithSetup(setup, killSwitches$);
        }
        if (parsed.cli.command === 'watch') {
            watchWithSetup(setup, killSwitches$);
        }
        if (parsed.cli.command === 'watchers') {
            watchersWithSetup(setup, killSwitches$);
        }
    });
}
function runWithSetup(prepared, killSwitches$) {
    var setUp$ = new Rx.BehaviorSubject({});
    var progress$ = new Rx.BehaviorSubject([]);
    var summaryGiven = false; // todo remove the need for this as it breaks the encapsulation
    var exitSignal$ = prepared.config.signalObserver
        .filter(function (x) { return x.type === config_1.SignalTypes.Exit; })
        .do(function (cbSignal) { return prepared.reportFn({
        type: reports.ReportTypes.SignalReceived,
        data: cbSignal.data
    }); })
        .withLatestFrom(setUp$, progress$, function (signal, setup, reports) {
        return { reports: reports, setup: setup, signal: signal };
    });
    var exits$ = Rx.Observable.zip(Rx.Observable.just(true).timestamp(prepared.config.scheduler), exitSignal$.timestamp(prepared.config.scheduler), function (begin, signal) {
        return { begin: begin, signal: signal };
    }).do(function (incoming) {
        var signal = incoming.signal, begin = incoming.begin;
        var setup = signal.value.setup;
        var reports = signal.value.reports;
        var startTime = begin.timestamp;
        var endTime = signal.timestamp;
        /**
         * Main summary report, although here it could be partial
         * (as an exit command could occur at any time)
         */
        if ((setup.tasks.valid.length * 2) !== reports.length) {
            if (!summaryGiven) {
                summaryGiven = true;
                handleCompletion(reports, setup, endTime - startTime);
            }
        }
        else {
            console.log("Exit signal, but summary given from main handler");
        }
    });
    var reports$ = index_1.handleIncoming(prepared)
        .do(function (x) { return setUp$.onNext(x.setup); }) // first item is the setup
        .flatMap(function (x) {
        if (x.setup.errors.length) {
            killSwitches$.onNext(true);
            return Rx.Observable.empty();
        }
        if (x.setup.tasks.invalid.length) {
            killSwitches$.onNext(true);
            return Rx.Observable.empty();
        }
        return x.update$;
    })
        .do(function (x) { return progress$.onNext(progress$.getValue().concat(x)); })
        .do(function (report) {
        prepared.reportFn({
            type: reports.ReportTypes.TaskReport,
            data: {
                report: report,
                config: prepared.config
            }
        });
    })
        .takeUntil(exits$)
        .toArray()
        .filter(function (reports) { return reports.length > 0; })
        .timestamp(prepared.config.scheduler)
        .withLatestFrom(setUp$, function (incoming, setup) {
        return {
            setup: setup,
            reports: incoming.value,
            timestamp: incoming.timestamp
        };
    });
    Rx.Observable.zip(Rx.Observable.just(true).timestamp(prepared.config.scheduler), reports$, function (begin, result) {
        return { begin: begin, result: result };
    }).subscribe(function (incoming) {
        if (!summaryGiven) {
            summaryGiven = true;
            handleCompletion(incoming.result.reports, incoming.result.setup, incoming.result.timestamp - incoming.begin.timestamp);
        }
    });
    /**
     * Handle file-writes
     * @type {Rx.Observable<CBSignal<FileWriteSignal>>|Rx.Observable<T>}
     */
    prepared.config.signalObserver
        .filter(function (x) { return x.type === config_1.SignalTypes.FileWrite; })
        .do(function (x) {
        if (prepared.config.dryRun) {
        }
        else {
            file.writeFileToDisk(x.data.file, x.data.content);
        }
    }).subscribe();
    /**
     * Because errors are handled by reports, task executions ALWAYS complete
     * and we handle that here.
     */
    function handleCompletion(taskReports, setup, runtime) {
        /**
         * Merge sequence tree with Task Reports
         */
        var decoratedSequence = seq.decorateSequenceWithReports(setup.sequence, taskReports);
        /**
         * Push a 'Completion report' onto the $complete Observable.
         * This means consumers will get everything when they call
         */
        var errors = taskReports.filter(function (x) { return x.type === task_runner_1.TaskReportType.error; });
        var completeData = {
            errors: errors,
            runtime: runtime,
            taskErrors: errors,
            sequence: decoratedSequence,
            cli: prepared.cli,
            config: prepared.config
        };
        /**
         * Main summary report
         */
        prepared.reportFn({
            type: reports.ReportTypes.Summary,
            data: completeData
        });
        require("./command.run.post-execution").postCliExecution(completeData);
    }
}
function docsWithSetup(prepared, killSwitches$) {
    index_1.handleIncoming(prepared)
        .pluck("setup")
        .subscribe(function (setup) {
        if (setup.errors.length) {
            return killSwitches$.onNext(true);
        }
        if (setup.output) {
            setup.output.forEach(function (outputItem) {
                file.writeFileToDisk(outputItem.file, outputItem.content);
            });
        }
    });
}
function initWithSetup(prepared, killSwitches$) {
    index_1.handleIncoming(prepared)
        .pluck("setup")
        .subscribe(function (setup) {
        if (setup.errors.length) {
            return killSwitches$.onNext(true);
        }
        fs_1.writeFileSync(setup.outputFilePath, fs_1.readFileSync(setup.templateFilePath));
    });
}
function tasksWithSetup(prepared, killSwitches$) {
    index_1.handleIncoming(prepared)
        .subscribe(function (x) {
        var _a = x.setup, groups = _a.groups, tasks = _a.tasks;
        var invalid = groups.reduce(function (acc, group) { return acc.concat(group.tasks.invalid); }, []);
        if (invalid.length || prepared.config.verbose === 1 /* Verbose */) {
            return prepared.reportFn({
                type: reports.ReportTypes.TaskTree,
                data: {
                    tasks: tasks,
                    config: prepared.config,
                    title: invalid.length ? "Errors found:" : "Available Tasks:"
                }
            });
        }
        if (!groups.length) {
            return prepared.reportFn({ type: reports.ReportTypes.NoTasksAvailable });
        }
        prepared.reportFn({
            type: reports.ReportTypes.SimpleTaskList,
            data: { setup: x.setup }
        });
    });
}
function watchWithSetup(prepared, killSwitches$) {
    index_1.handleIncoming(prepared)
        .flatMap(function (x) {
        if (x.setup.errors.length) {
            killSwitches$.onNext(true);
            return Rx.Observable.empty();
        }
        return x.update$; // start the watchers
    })
        .subscribe();
}
function watchersWithSetup(prepared, killSwitches$) {
    index_1.handleIncoming(prepared)
        .pluck("setup")
        .subscribe(function (setup) {
        if (setup.errors.length) {
            return killSwitches$.onNext(true);
        }
        prepared.reportFn({
            type: reports.ReportTypes.WatcherNames,
            data: { setup: setup }
        });
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvY2IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFLQSxtQ0FBNEU7QUFHNUUsNkNBQXlEO0FBS3pELDZCQUF3QjtBQUN4Qix5QkFBK0M7QUFDL0MsaUNBQWdFO0FBQ2hFLG1DQUE4QjtBQUc5Qiw0Q0FBOEM7QUFDOUMsbUNBQXFDO0FBQ3JDLHFDQUF1QztBQUV2Qyx1QkFBMEI7QUFDMUIsMkNBQW1DO0FBRW5DLElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN6QyxJQUFNLENBQUMsR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUN0QyxJQUFNLE1BQU0sR0FBRyxhQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUUxQyxJQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztBQUNyRCxJQUFNLGlCQUFpQixHQUFHLFVBQUMsS0FBSztJQUM1QixJQUFNLE1BQU0sR0FBRyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsZ0JBQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQWpCLENBQWlCLENBQUMsQ0FBQztJQUNuRCxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBRUYsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDakIsVUFBVSxDQUFDLE1BQU0sRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0FBQzFDLENBQUM7QUFBQyxJQUFJLENBQUMsQ0FBQztJQUNKLEVBQUUsQ0FBQyxDQUFDLE1BQU0s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