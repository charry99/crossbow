"use strict";
var file_utils_1 = require("./file.utils");
var ReporterErrorTypes;
(function (ReporterErrorTypes) {
    ReporterErrorTypes[ReporterErrorTypes["ReporterFileNotFound"] = "ReporterFileNotFound"] = "ReporterFileNotFound";
    ReporterErrorTypes[ReporterErrorTypes["ReporterTypeNotSupported"] = "ReporterTypeNotSupported"] = "ReporterTypeNotSupported";
})(ReporterErrorTypes = exports.ReporterErrorTypes || (exports.ReporterErrorTypes = {}));
var ReporterTypes;
(function (ReporterTypes) {
    ReporterTypes[ReporterTypes["InlineFunction"] = "InlineFunction"] = "InlineFunction";
    ReporterTypes[ReporterTypes["ExternalFile"] = "ExternalFile"] = "ExternalFile";
    ReporterTypes[ReporterTypes["UnsupportedValue"] = "UnsupportedValue"] = "UnsupportedValue";
    ReporterTypes[ReporterTypes["Muted"] = "Muted"] = "Muted";
})(ReporterTypes = exports.ReporterTypes || (exports.ReporterTypes = {}));
var ReportTypes;
(function (ReportTypes) {
    ReportTypes[ReportTypes["DuplicateInputFile"] = "DuplicateInputFile"] = "DuplicateInputFile";
    ReportTypes[ReportTypes["InputFileCreated"] = "InputFileCreated"] = "InputFileCreated";
    ReportTypes[ReportTypes["InitInputFileTypeNotSupported"] = "InitInputFileTypeNotSupported"] = "InitInputFileTypeNotSupported";
    ReportTypes[ReportTypes["InputError"] = "InputError"] = "InputError";
    ReportTypes[ReportTypes["BinOptionError"] = "BinOptionError"] = "BinOptionError";
    ReportTypes[ReportTypes["EnvFileOptionError"] = "EnvFileOptionError"] = "EnvFileOptionError";
    ReportTypes[ReportTypes["InputFileNotFound"] = "InputFileNotFound"] = "InputFileNotFound";
    ReportTypes[ReportTypes["InvalidReporter"] = "InvalidReporter"] = "InvalidReporter";
    ReportTypes[ReportTypes["InvalidBinDirectory"] = "InvalidBinDirectory"] = "InvalidBinDirectory";
    ReportTypes[ReportTypes["UsingInputFile"] = "UsingInputFile"] = "UsingInputFile";
    ReportTypes[ReportTypes["TaskList"] = "TaskList"] = "TaskList";
    ReportTypes[ReportTypes["TaskTree"] = "TaskTree"] = "TaskTree";
    ReportTypes[ReportTypes["TaskErrors"] = "TaskErrors"] = "TaskErrors";
    ReportTypes[ReportTypes["TaskReport"] = "TaskReport"] = "TaskReport";
    ReportTypes[ReportTypes["NoTasksAvailable"] = "NoTasksAvailable"] = "NoTasksAvailable";
    ReportTypes[ReportTypes["NoTasksProvided"] = "NoTasksProvided"] = "NoTasksProvided";
    ReportTypes[ReportTypes["SimpleTaskList"] = "SimpleTaskList"] = "SimpleTaskList";
    ReportTypes[ReportTypes["BeforeWatchTaskErrors"] = "BeforeWatchTaskErrors"] = "BeforeWatchTaskErrors";
    ReportTypes[ReportTypes["BeforeTaskList"] = "BeforeTaskList"] = "BeforeTaskList";
    ReportTypes[ReportTypes["BeforeTasksDidNotComplete"] = "BeforeTasksDidNotComplete"] = "BeforeTasksDidNotComplete";
    ReportTypes[ReportTypes["BeforeTasksSummary"] = "BeforeTasksSummary"] = "BeforeTasksSummary";
    ReportTypes[ReportTypes["WatchTaskTasksErrors"] = "WatchTaskTasksErrors"] = "WatchTaskTasksErrors";
    ReportTypes[ReportTypes["WatchTaskErrors"] = "WatchTaskErrors"] = "WatchTaskErrors";
    ReportTypes[ReportTypes["WatchTaskReport"] = "WatchTaskReport"] = "WatchTaskReport";
    ReportTypes[ReportTypes["NoFilesMatched"] = "NoFilesMatched"] = "NoFilesMatched";
    ReportTypes[ReportTypes["NoWatchersAvailable"] = "NoWatchersAvailable"] = "NoWatchersAvailable";
    ReportTypes[ReportTypes["NoWatchTasksProvided"] = "NoWatchTasksProvided"] = "NoWatchTasksProvided";
    ReportTypes[ReportTypes["Watchers"] = "Watchers"] = "Watchers";
    ReportTypes[ReportTypes["WatcherNames"] = "WatcherNames"] = "WatcherNames";
    ReportTypes[ReportTypes["WatcherTriggeredTasksCompleted"] = "WatcherTriggeredTasksCompleted"] = "WatcherTriggeredTasksCompleted";
    ReportTypes[ReportTypes["WatcherTriggeredTasks"] = "WatcherTriggeredTasks"] = "WatcherTriggeredTasks";
    ReportTypes[ReportTypes["WatcherSummary"] = "WatcherSummary"] = "WatcherSummary";
    ReportTypes[ReportTypes["DocsAddedToFile"] = "DocsAddedToFile"] = "DocsAddedToFile";
    ReportTypes[ReportTypes["DocsGenerated"] = "DocsMarkdownGenerated"] = "DocsGenerated";
    ReportTypes[ReportTypes["DocsInputFileNotFound"] = "DocsInputFileNotFound"] = "DocsInputFileNotFound";
    ReportTypes[ReportTypes["DocsOutputFileExists"] = "DocsOutputFileExists"] = "DocsOutputFileExists";
    ReportTypes[ReportTypes["DocsInvalidTasksSimple"] = "DocsInvalidTasksSimple"] = "DocsInvalidTasksSimple";
    ReportTypes[ReportTypes["HashDirError"] = "HashDirError"] = "HashDirError";
    ReportTypes[ReportTypes["Summary"] = "Summary"] = "Summary";
    ReportTypes[ReportTypes["SignalReceived"] = "SignalReceived"] = "SignalReceived";
    ReportTypes[ReportTypes["CLIParserOutput"] = "CLIParserOutput"] = "CLIParserOutput";
})(ReportTypes = exports.ReportTypes || (exports.ReportTypes = {}));
function getReporters(config) {
    var reporters = (function () {
        /**
         * If --outputOnly (-q) was given, the user wants NO
         * output, other than output from child processes - this
         * is used for shell expansion within other tasks where
         * the 'using crossbow.yaml' or completions summaries are
         * unwanted.
         */
        if (config.outputOnly) {
            return [{
                    type: ReporterTypes.Muted,
                    callable: function () { },
                    errors: [],
                    sources: []
                }];
        }
        /**
         * At this point, a user may of provided a string (as a path to lookup)
         * or a function directly, so we use those to resolve the reporters.
         */
        return [].concat(config.reporters).map(getOneReporter);
    })();
    return {
        all: reporters,
        valid: reporters.filter(function (x) { return x.errors.length === 0; }),
        invalid: reporters.filter(function (x) { return x.errors.length > 0; })
    };
    function getOneReporter(reporter) {
        /**
         * If a function was given as a reported (eg: inline)
         * then it's ALWAYS a valid reporter
         */
        if (typeof reporter === "function") {
            return {
                type: ReporterTypes.InlineFunction,
                callable: reporter,
                errors: [],
                sources: []
            };
        }
        /**
         * If the reporter was not a string or function
         * it's definitely an unsupported type
         */
        if (typeof reporter !== "string") {
            return {
                type: ReporterTypes.UnsupportedValue,
                errors: [{ type: ReporterErrorTypes.ReporterTypeNotSupported }],
                sources: [reporter]
            };
        }
        var files = file_utils_1.readFilesFromDisk([reporter], config.cwd);
        var errors = files
            .reduce(function (acc, item) {
            // Convert errors from reading files
            // into errors about reporters
            // This is for correct context in logging
            if (item.errors.length) {
                return acc.concat({
                    type: ReporterErrorTypes.ReporterFileNotFound,
                    file: item
                });
            }
            return acc;
        }, []);
        /**
         * If any errors occurred, return them
         */
        if (errors.length) {
            return {
                type: ReporterTypes.ExternalFile,
                errors: errors,
                sources: files
            };
        }
        /**
         * Now try to 'require' the module. If it
         * does not contain a default export, create an error
         */
        var callable = require(files[0].resolved);
        if (typeof callable !== "function") {
            return {
                type: ReporterTypes.UnsupportedValue,
                errors: [{ type: ReporterErrorTypes.ReporterTypeNotSupported }],
                sources: [files[0]]
            };
        }
        /**
         * Here we have a valid external file to return
         * as a single reporter
         */
        return {
            type: ReporterTypes.ExternalFile,
            callable: callable,
            errors: [],
            sources: files
        };
    }
}
exports.getReporters = getReporters;
function getDefaultReporter() {
    return require("./reporters/defaultReporter").default;
}
exports.getDefaultReporter = getDefaultReporter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3J0ZXIucmVzb2x2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXBvcnRlci5yZXNvbHZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSwyQ0FBd0g7QUF3QnhILElBQVksa0JBR1g7QUFIRCxXQUFZLGtCQUFrQjtJQUMxQixnRUFBNEIsc0JBQXNCLDBCQUFBLENBQUE7SUFDbEQsb0VBQWdDLDBCQUEwQiw4QkFBQSxDQUFBO0FBQzlELENBQUMsRUFIVyxrQkFBa0IsR0FBbEIsMEJBQWtCLEtBQWxCLDBCQUFrQixRQUc3QjtBQVFELElBQVksYUFLWDtBQUxELFdBQVksYUFBYTtJQUNyQixnREFBd0IsZ0JBQWdCLG9CQUFBLENBQUE7SUFDeEMsOENBQXdCLGNBQWMsa0JBQUEsQ0FBQTtJQUN0QyxrREFBd0Isa0JBQWtCLHNCQUFBLENBQUE7SUFDMUMsdUNBQXdCLE9BQU8sV0FBQSxDQUFBO0FBQ25DLENBQUMsRUFMVyxhQUFhLEdBQWIscUJBQWEsS0FBYixxQkFBYSxRQUt4QjtBQVFELElBQVksV0ErQ1g7QUEvQ0QsV0FBWSxXQUFXO0lBQ25CLGdEQUFzQyxvQkFBb0Isd0JBQUEsQ0FBQTtJQUMxRCw4Q0FBc0Msa0JBQWtCLHNCQUFBLENBQUE7SUFDeEQsMkRBQXNDLCtCQUErQixtQ0FBQSxDQUFBO0lBQ3JFLHdDQUFzQyxZQUFZLGdCQUFBLENBQUE7SUFDbEQsNENBQXNDLGdCQUFnQixvQkFBQSxDQUFBO0lBQ3RELGdEQUFzQyxvQkFBb0Isd0JBQUEsQ0FBQTtJQUMxRCwrQ0FBc0MsbUJBQW1CLHVCQUFBLENBQUE7SUFDekQsNkNBQXNDLGlCQUFpQixxQkFBQSxDQUFBO0lBQ3ZELGlEQUFzQyxxQkFBcUIseUJBQUEsQ0FBQTtJQUMzRCw0Q0FBc0MsZ0JBQWdCLG9CQUFBLENBQUE7SUFFdEQsc0NBQXNDLFVBQVUsY0FBQSxDQUFBO0lBQ2hELHNDQUFzQyxVQUFVLGNBQUEsQ0FBQTtJQUNoRCx3Q0FBc0MsWUFBWSxn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