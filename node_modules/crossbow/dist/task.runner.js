"use strict";
var task_resolve_1 = require("./task.resolve");
var task_return_values_1 = require("./task.return.values");
var Rx = require("rx");
var debug = require("debug")("cb:task.runner");
var _ = require("../lodash.custom");
var once = require("once");
var domain = require("domain");
var TaskReportType;
(function (TaskReportType) {
    TaskReportType[TaskReportType["start"] = "start"] = "start";
    TaskReportType[TaskReportType["end"] = "end"] = "end";
    TaskReportType[TaskReportType["error"] = "error"] = "error";
})(TaskReportType = exports.TaskReportType || (exports.TaskReportType = {}));
var TaskSkipReasons;
(function (TaskSkipReasons) {
    TaskSkipReasons[TaskSkipReasons["SkipFlag"] = "SkipFlag"] = "SkipFlag";
    TaskSkipReasons[TaskSkipReasons["IfChanged"] = "IfChanged"] = "IfChanged";
})(TaskSkipReasons = exports.TaskSkipReasons || (exports.TaskSkipReasons = {}));
/**
 * This creates a wrapper around the actual function that will be run.
 * This done to allow the before/after reporting to work as expected for consumers
 */
function time(scheduler) {
    return scheduler ? scheduler.now() : new Date().getTime();
}
exports.time = time;
function createObservableFromSequenceItem(item, trigger, ctx) {
    var taskTrigger = _.assign({}, trigger, ctx.toJS());
    return Rx.Observable.create(function (observer) {
        var startTime = time(taskTrigger.config.scheduler);
        /**
         * Complete immediately if this item was marked
         * as 'skipped'
         */
        if (!taskTrigger.config.force && item.task.skipped) {
            var additionalStats = {
                skipped: true,
                skippedReason: TaskSkipReasons.SkipFlag
            };
            var stats_1 = getStartStats(startTime, additionalStats);
            observer.onNext(getTaskReport(TaskReportType.start, item, stats_1));
            observer.onNext(getTaskReport(TaskReportType.end, item, getEndStats(stats_1, startTime, additionalStats)));
            observer.onCompleted();
            return;
        }
        /**
         * Complete immediately if this item was marked
         * with an 'ifChanged' predicate
         */
        if (!taskTrigger.config.force && item.task.ifChanged.length && ctx.hasIn(["ifChanged"])) {
            var hasChanges = ctx
                .get("ifChanged")
                .filter(function (x) {
                return item.task.ifChanged.indexOf(x.get("userInput")) !== -1;
            })
                .some(function (x) { return x.get("changed"); });
            if (!hasChanges) {
                var additionalStats = {
                    skipped: true,
                    skippedReason: TaskSkipReasons.IfChanged
                };
                var stats_2 = getStartStats(startTime, additionalStats);
                observer.onNext(getTaskReport(TaskReportType.start, item, stats_2));
                observer.onNext(getTaskReport(TaskReportType.end, item, getEndStats(stats_2, startTime, additionalStats)));
                observer.onCompleted();
                return;
            }
        }
        /**
         * Timestamp when this task starts
         * @type {TaskStats}
         */
        var stats = getStartStats(startTime, { skipped: false });
        debug("> seqUID " + item.seqUID + " started");
        /**
         * Task started
         */
        observer.onNext(getTaskReport(TaskReportType.start, item, stats));
        /**
         * Exit after 1 second if we're in a 'dry run'
         */
        if (taskTrigger.config.dryRun) {
            return Rx.Observable
                .just("dryRun")
                .delay(taskTrigger.config.dryRunDuration, taskTrigger.config.scheduler)
                .do(function (_) {
                observer.onNext(getTaskReport(TaskReportType.end, item, getEndStats(stats, time(taskTrigger.config.scheduler))));
                observer.onCompleted();
            }).subscribe();
        }
        if (item.task.type === task_resolve_1.TaskTypes.InlineFunction
            || item.task.type === task_resolve_1.TaskTypes.ExternalTask
            || item.task.type === task_resolve_1.TaskTypes.Adaptor) {
            var argCount = item.factory.length;
            var cb_1 = once(function (err) {
                if (err) {
                    observer.onError(err);
                    return;
                }
                observer.onNext(getTaskReport(TaskReportType.end, item, getEndStats(stats, time(taskTrigger.config.scheduler))));
                observer.onCompleted();
            });
            var d_1 = domain.create();
            d_1.once("error", function (err) {
                cb_1(err);
            });
            var domainBoundFn = d_1.bind(item.factory.bind(null, item.options, taskTrigger));
            var done = function (err) {
                d_1.removeListener("error", function (err) {
                    cb_1(err);
                });
                d_1.exit();
                return cb_1.apply(null, arguments);
            };
            var result = domainBoundFn(done);
            if (result) {
                var returns = task_return_values_1.default(result, done);
                /**
                 * If the return value does not need to be consumed,
                 * but it is IS a function, assume it's the tear-down logic
                 * for this task - which also means it MUST signify completion
                 * via the callback
                 */
                if (!returns && typeof result === "function") {
                    if (argCount >= 3) {
                        return result;
                    }
                    else {
                        done(new Error("You returned tear-down logic, but you never asked for the completion callback"));
                        return;
                    }
                }
            }
            else {
                /**
                 * Assume sync function if nothing returned
                 * and 3rd argument was not asked for
                 */
                if (argCount < 3) {
                    done();
                    return;
                }
            }
        }
    }).catch(function (error) {
        /**
         * **--**--MAGIC--**--**
         * If a task throws an error of any kind, we want that error to propagate as normal,
         * but we want tp prepend an error report so that the error report can be observed
         * before the sequence ends.
         */
        return Rx.Observable.concat(Rx.Observable.just(getTaskErrorReport(item, getErrorStats(error, time(taskTrigger.config.scheduler)))), Rx.Observable.throw(error));
    });
}
exports.createObservableFromSequenceItem = createObservableFromSequenceItem;
/**
 * Factory for TaskReports
 */
function getTaskReport(type, item, stats) {
    return { type: type, item: item, stats: stats };
}
/**
 * Create a new stats object with startTime
 */
function getStartStats(startTime, additional) {
    return _.assign({}, additional, {
        startTime: startTime,
        started: true,
        endTime: 0,
        duration: 0,
        completed: false,
        errors: []
    });
}
exports.getStartStats = getStartStats;
/**
 * Create a new stats object with completed/duration flags etc
 */
function getEndStats(stats, endTime, additional) {
    return _.assign({}, stats, additional, {
        endTime: endTime,
        duration: endTime - stats.startTime,
        completed: true
    });
}
/**
 * Factory for TaskReports that errored
 */
function getTaskErrorReport(item, stats) {
    return { type: TaskReportType.error, item: item, stats: stats };
}
/**
 * Get basic stats for a task error
 */
function getErrorStats(error, endTime) {
    if (error._cbError) {
        return {
            endTime: endTime,
            completed: false,
            errors: [error],
            cbError: true,
            cbExitCode: error._cbExitCode
        };
    }
    return {
        endTime: endTime,
        completed: false,
        errors: [error]
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay5ydW5uZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdGFzay5ydW5uZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLCtDQUF5QztBQUl6QywyREFBb0Q7QUFHcEQsdUJBQWlDO0FBR2pDLElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQ2pELElBQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ3RDLElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM3QixJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFzQ2pDLElBQVksY0FJWDtBQUpELFdBQVksY0FBYztJQUN0Qix5Q0FBYSxPQUFPLFdBQUEsQ0FBQTtJQUNwQix1Q0FBVyxLQUFLLFNBQUEsQ0FBQTtJQUNoQix5Q0FBYSxPQUFPLFdBQUEsQ0FBQTtBQUN4QixDQUFDLEVBSlcsY0FBYyxHQUFkLHNCQUFjLEtBQWQsc0JBQWMsUUFJekI7QUFFRCxJQUFZLGVBR1g7QUFIRCxXQUFZLGVBQWU7SUFDdkIsOENBQWdCLFVBQVUsY0FBQSxDQUFBO0lBQzFCLCtDQUFpQixXQUFXLGVBQUEsQ0FBQTtBQUNoQyxDQUFDLEVBSFcsZUFBZSxHQUFmLHVCQUFlLEtBQWYsdUJBQWUsUUFHMUI7QUFZRDs7O0dBR0c7QUFDSCxjQUFxQixTQUFVO0lBQzNCLE1BQU0sQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDOUQsQ0FBQztBQUZELG9CQUVDO0FBQ0QsMENBQWlELElBQWtCLEVBQUUsT0FBdUIsRUFBRSxHQUFlO0lBRXpHLElBQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsSUFB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