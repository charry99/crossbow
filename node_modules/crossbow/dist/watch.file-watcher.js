"use strict";
var seq = require("./task.sequence");
var task_runner_1 = require("./task.runner");
var Rx = require("rx");
var reporter_resolve_1 = require("./reporter.resolve");
var command_watch_1 = require("./command.watch");
var immutable_1 = require("immutable");
var debug = require("debug")("cb:watch.runner");
/**
 * Create a stream that is the combination of all watchers
 */
function createObservablesForWatchers(watchers, trigger) {
    /**
     * Wrap every chokidar watcher in an observable
     * @type {Rx.Observable<WatchEvent>[]}
     */
    var _nonGrouped = watchers.filter(function (watcher) { return watcher.options.group === 0; });
    var _grouped = watchers.filter(function (watcher) { return watcher.options.group > 0; });
    var watchersAsObservablesNonGrouped = _nonGrouped
        .map(function (watcher) {
        return createObservableForWatcher(watcher, trigger);
    });
    var watchersAsObservablesGrouped = _grouped
        .map(function (watcher) {
        return createObservableForWatcher(watcher, trigger);
    });
    var blockable$ = new Rx.BehaviorSubject([]);
    /**
     * Now map file-change events to task running
     */
    return (_a = Rx.Observable).merge.apply(_a, watchersAsObservablesNonGrouped.concat(watchersAsObservablesGrouped)).filter(function (x) {
        if (x.watcher.options.block) {
            var blocked = !~blockable$.getValue().indexOf(x.watcher.watcherUID);
            if (x.watchEvent) {
                debug("BLOCKED - " + x.watcher.watcherUID + " " + x.watchEvent.path + " " + x.watchEvent.event);
            }
            else {
                x.watchEvents.forEach(function (watchEvent) {
                    debug("BLOCKED - " + x.watcher.watcherUID + " " + watchEvent.path + " " + watchEvent.event);
                });
            }
            return blocked;
        }
        return true;
    })
        .do(function (x) {
        if (x.watcher.options.block) {
            blockable$.onNext(blockable$.getValue().concat(x.watcher.watcherUID));
        }
    })
        .timestamp(trigger.config.scheduler)
        .flatMap(function (incoming, i) {
        return runTasks(incoming, i);
    });
    function runTasks(incoming, i) {
        /**
         * @type {WatchEvent}
         */
        var _a = incoming.value, watchEvent = _a.watchEvent, watcher = _a.watcher, _b = _a.watchEvents, watchEvents = _b === void 0 ? [] : _b;
        return Rx.Observable.create(function (obs) {
            /**
             * Report start of task run
             */
            trigger.reporter({
                type: reporter_resolve_1.ReportTypes.WatcherTriggeredTasks,
                data: {
                    index: i,
                    taskCollection: watcher.tasks
                }
            });
            /**
             * todo: Is there a way to handle this without subscribing manually?
             */
            watcher._runner.series(immutable_1.fromJS({
                watchEvent: watchEvent,
                watchEvents: watchEvents,
                watcher: {
                    patterns: watcher.patterns,
                    tasks: watcher.tasks,
                    options: watcher.options,
                    watcherUID: watcher.watcherUID
                }
            }))
                .do(function (taskReport) {
                var data = {
                    taskReport: taskReport,
                    watchEvent: watchEvent,
                    watchEvents: watchEvents,
                    count: i
                };
                obs.onNext({
                    type: command_watch_1.WatchCommandEventTypes.WatchTaskReport,
                    data: data,
                });
            })
                .toArray()
                .timestamp(trigger.config.scheduler)
                .subscribe(function (x) {
                var reports = x.value;
                var sequence = seq.decorateSequenceWithReports(watcher._sequence, reports);
                var errors = reports.filter(function (x) { return x.type === task_runner_1.TaskReportType.error; });
                var data = {
                    sequence: sequence,
                    reports: reports,
                    errors: errors,
                    watchEvent: watchEvent,
                    watchEvents: watchEvents,
                    runtime: x.timestamp - incoming.timestamp
                };
                obs.onNext({
                    type: command_watch_1.WatchCommandEventTypes.WatchRunnerComplete,
                    data: data,
                });
                if (errors.length > 0) {
                    trigger.reporter({
                        type: reporter_resolve_1.ReportTypes.WatcherSummary,
                        data: {
                            sequence: sequence,
                            cli: trigger.cli,
                            title: watcher.tasks.join(", "),
                            config: trigger.config,
                            runtime: x.timestamp - incoming.timestamp,
                            watcher: watcher,
                            watchEvent: watchEvent,
                            watchEvents: watchEvents,
                        }
                    });
                }
                else {
                    trigger.reporter({
                        type: reporter_resolve_1.ReportTypes.WatcherTriggeredTasksCompleted,
                        data: {
                            index: i,
                            taskCollection: watcher.tasks,
                            time: x.timestamp - incoming.timestamp
                        }
                    });
                }
                var withoutThis = blockable$.getValue().filter(function (x) { return x !== watchEvent.watcherUID; });
                blockable$.onNext(withoutThis);
                obs.onCompleted();
            });
        });
    }
    var _a;
}
exports.createObservablesForWatchers = createObservablesForWatchers;
/**
 * Create a file-system watcher that will emit <WatchEvent>
 */
function createObservableForWatcher(watcher, trigger) {
    var reporter = trigger.reporter;
    var scheduler = trigger.config.scheduler;
    /**
     * First create a stream of file-watcher events for this Watcher
     */
    var output$ = trigger.config.fileChangeObserver || getFileChangeStream(watcher, reporter);
    if (watcher.options.group > 0) {
        return output$
            .buffer(function () { return output$.debounce(watcher.options.group, scheduler); })
            .map(function (xs) {
            return {
                watcher: watcher,
                watchEvents: xs,
            };
        });
    }
    /**
     * Specify a mapping from option name -> Rx.Observable operator name
     */
    var additionalOperators = [
        {
            option: "debounce",
            fnName: "debounce"
        },
        {
            option: "throttle",
            fnName: "throttle"
        },
        {
            option: "delay",
            fnName: "delay"
        }
    ];
    return applyOperators(output$, additionalOperators, watcher.options, scheduler)
        .map(function (x) {
        return {
            watcher: watcher,
            watchEvent: x,
        };
    });
}
exports.createObservableForWatcher = createObservableForWatcher;
function getFileChangeStream(watcher, reporter) {
    /** DEBUG **/
    debug("[id:" + watcher.watcherUID + "] options: " + JSON.stringify(watcher.options, null, 2));
    /** DEBUG END **/
    return Rx.Observable.create(function (observer) {
        /** DEBUG **/
        debug("+ [id:" + watcher.watcherUID + "] " + watcher.patterns.length + " patterns (" + watcher.patterns + ")");
        debug("\u2514\u2500 " + watcher.tasks.length + " tasks (" + watcher.tasks + ")");
        /** DEBUG END **/
        var chokidarWatcher = require("chokidar").watch(watcher.patterns, watcher.options)
            .on("all", function (event, path) {
            debug("\u2514\u2500 CHOKIDAR EVENT " + event + " - " + path);
            observer.onNext({
                event: event,
                path: path,
                watcherUID: watcher.watcherUID
            });
        });
        chokidarWatcher.on("ready", function () {
            /** DEBUG **/
            debug("\u221A [id:" + watcher.watcherUID + "] watcher ready (" + watcher.patterns + ")");
            /** DEBUG END **/
            if (Object.keys(chokidarWatcher.getWatched()).length === 0) {
                reporter({ type: reporter_resolve_1.ReportTypes.NoFilesMatched, data: { watcher: watcher } });
            }
        });
        return function () {
            debug("- for " + watcher.patterns);
            chokidarWatcher.close();
        };
    }).share();
}
exports.getFileChangeStream = getFileChangeStream;
/**
 *
 */
function applyOperators(source, items, options, scheduler) {
    return items.reduce(function (stream$, item) {
        var value = options[item.option];
        if (value !== undefined && value > 0) {
            return stream$[item.fnName].call(stream$, value, scheduler);
        }
        return stream$;
    }, source);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2F0Y2guZmlsZS13YXRjaGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3dhdGNoLmZpbGUtd2F0Y2hlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EscUNBQXVDO0FBRXZDLDZDQUF5RDtBQUN6RCx1QkFBMEI7QUFFMUIsdURBQTRFO0FBRTVFLGlEQUF1RDtBQUN2RCx1Q0FBaUM7QUFHakMsSUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFvQ2xEOztHQUVHO0FBQ0gsc0NBQTZDLFFBQW1CLEVBQUUsT0FBdUI7SUFHckY7OztPQUdHO0lBQ0gsSUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxLQUFLLENBQUMsRUFBM0IsQ0FBMkIsQ0FBQyxDQUFDO0lBQzVFLElBQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQXpCLENBQXlCLENBQUMsQ0FBQztJQUN2RSxJQUFNLCtCQUErQixHQUFHLFdBQVc7U0FDOUMsR0FBRyxDQUFDLFVBQUMsT0FBTztRQUNULE1BQU0sQ0FBQywwQkFBMEIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDeEQsQ0FBQyxDQUFDLENBQUM7SUFDUCxJQUFNLDRCQUE0QixHQUFHLFFBQVE7U0FDeEMsR0FBRyxDQUFDLFVBQUMsT0FBTztRQUNULE1BQU0sQ0FBQywwQkFBMEIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDeEQsQ0FBQyxDQUFDLENBQUM7SUFFUCxJQUFNLFVBQVUsR0FBRyxJQUFJLEVBQUUsQ0FBQyxlQUFlLENBQVcsRUFBRSxDQUFDLENBQUM7SUFFeEQ7O09BRUc7SUFDSCxNQUFNLENBQUMsQ0FB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